<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>PROGRESS NEW VARIANT ENGP2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- XLSX dari CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
  <style>
    body { font-family: sans-serif; background:#f9fafb; padding:20px; margin:0; }
    h1 { text-align:center; font-weight:bold; text-transform:uppercase; margin-bottom:20px; font-size:32px; }
    table { border-collapse:collapse; width:100%; background:#fff; }
    th, td { border:1px solid #ccc; padding:4px; text-align:center; vertical-align:middle; }
    th { background:#f1f1f1; }

    /* sticky header 2 baris */
    thead tr:first-child th {
      position: sticky;
      top: 0;
      z-index: 6;
      background:#f1f1f1;
    }
    thead tr:nth-child(2) th {
      position: sticky;
      top: 32px;
      z-index: 5;
      background:#f1f1f1;
    }

    .holiday { background:#fdd; color:#a00; }
    .group { position:relative; }
    .group select { position:absolute; inset:0; opacity:0; cursor:pointer; }
    .group:hover select { opacity:1; }
    .group div { color:#000; font-weight:bold; }
    .btn { padding:6px 10px; margin:2px; border:none; border-radius:6px; cursor:pointer; font-size:14px; }
    .blue { background:#2563eb; color:#fff; }
    .red { background:#dc2626; color:#fff; }
    .green { background:#16a34a; color:#fff; }
    .yellow { background:#ca8a04; color:#fff; }
    .purple { background:#7e22ce; color:#fff; }

    /* sticky kiri */
    .sticky-col, .sticky-col-2, .sticky-col-3 {
      position: sticky;
      background:#f9fafb;
      z-index: 7;
      box-shadow: 2px 0 3px rgba(0,0,0,0.1);
    }
    .sticky-col { left:0; }
    .sticky-col-2 { left:40px; }
    .sticky-col-3 { left:160px; }

    td input {
      width:100%; box-sizing:border-box; text-align:center;
      border:none; outline:none; background:transparent; font: inherit;
    }

    /* warna background tiap kode */
    .cell-PT   { background:#e0f2fe; font-weight:bold; }
    .cell-LTL  { background:#ede9fe; font-weight:bold; }
    .cell-SH   { background:#fef9c3; font-weight:bold; }
    .cell-HT   { background:#fee2e2; font-weight:bold; }
    .cell-PA   { background:#dcfce7; font-weight:bold; }
    .cell-AS   { background:#f3e8ff; font-weight:bold; }
    .cell-FG   { background:#cffafe; font-weight:bold; }
    .cell-ASS  { background:#fde68a; font-weight:bold; }
    .cell-D    { background:#bbf7d0; font-weight:bold; }

    .isp-delivered { background:#bbf7d0 !important; font-weight:bold; }
  </style>
</head>
<body>

<h1>PROGRESS NEW VARIANT ENGP2</h1>

<div>
  <button onclick="prevMonth()" class="btn">‚óÄ</button>
  <span id="monthLabel" style="font-weight:bold;"></span>
  <button onclick="nextMonth()" class="btn">‚ñ∂</button>

  <button onclick="addRow()" class="btn blue">Tambah Baris</button>
  <button onclick="deleteLastRow()" class="btn red">Hapus Baris Terakhir</button>
  <button onclick="saveDataOnline()" class="btn green">Save Online</button>
  <button onclick="loadDataOnline()" class="btn blue">Load Online</button>
  <button onclick="exportExcel()" class="btn yellow">Export Excel</button>
  <label class="btn purple">
    Import Excel
    <input type="file" id="importFile" style="display:none" onchange="importExcel(event)">
  </label>
  <button onclick="hideCheckedRows()" class="btn red">Hide Centang</button>
  <button onclick="unhideCheckedRows()" class="btn green">Unhide Centang</button>
</div>

<div style="overflow:auto; margin-top:10px; max-height:70vh;">
  <table id="scheduleTable" class="fit"></table>
</div>

<div id="hiddenList" style="margin-top:10px;"></div>
<p id="avgLeadtime" style="font-weight:bold; margin-top:10px;"></p>
<p><b>Note:</b> PT => Potong, LTL => Long Taper, SH => Shearing, HT => Heating, PA => Pre Assy, 
AS => Assy, FG => Finish Good, ASS => Assessment, D => Delivery</p>

<script>
/* === Konfigurasi Firebase (ganti dengan punya Anda) === */
const firebaseConfig = {
  apiKey: "AIzaSyXXXXXXX",
  authDomain: "yourproject.firebaseapp.com",
  projectId: "yourproject",
  storageBucket: "yourproject.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abcdef123456"
};

// Init Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* === Data & fungsi utama (ringkas dari versi Anda) === */
const options = ["", "PT", "LTL", "SH", "HT", "PA", "AS", "FG", "ASS", "D"];
const holidays = new Set(["2025-01-01","2025-08-17"]);
let rows = Array.from({length:10}).map((_,i)=>({id:i+1, isp:"", qty:"", remark:"", leadtime:0, hidden:false}));
let data = {};
let currentMonth = new Date(new Date().getFullYear(), new Date().getMonth(),1);

/* fungsi daysInMonth, formatDateKey, dll sama persis */
function daysInMonth(y,m){return new Date(y,m+1,0).getDate();}
function formatDateKey(d){return d.toISOString().slice(0,10);}
function isSunday(d){return d.getDay()===0;}
function isHoliday(d){return holidays.has(formatDateKey(d));}
function twoDigit(n){return n.toString().padStart(2,'0');}

function render(){ /* isi render tabel sama seperti versi sebelumnya */ }

/* === Firebase Save / Load === */
async function saveDataOnline(){
  await db.collection("progress").doc("main").set({
    rows,
    data,
    currentMonth: currentMonth.toISOString()
  });
  alert("‚úÖ Data tersimpan ke Firebase!");
}

async function loadDataOnline(){
  const snap = await db.collection("progress").doc("main").get();
  if(snap.exists){
    const parsed=snap.data();
    rows=parsed.rows || rows;
    data=parsed.data || data;
    currentMonth=new Date(parsed.currentMonth)||currentMonth;
    render();
    alert("üì• Data berhasil dimuat dari Firebase!");
  } else {
    alert("‚ö†Ô∏è Belum ada data di Firebase.");
  }
}

/* fungsi lain: addRow, deleteRow, handleCellChange, dll sama */
</script>
</body>
</html>
